import json
from datetime import datetime, timedelta

# فایل ذخیره‌سازی
fileName = "کارها.json"

# تابع برای بررسی وضعیت
def وضعیت(وضعیت_کار):
    if وضعیت_کار == "تموم شده":
        return "✅ کامپیوتر تموم شده"
    else:
        return "❌ وضعیت تموم نشده"

# محاسبه تاریخ پایان
def محاسبه_تاریخ_پایان(تاریخ_شروع, مدت_زمان):
    شروع = datetime.strptime(تاریخ_شروع, "%Y-%m-%d")
    پایان = شروع + timedelta(days=مدت_زمان)
    return پایان.strftime("%Y-%m-%d")

# نمایش لیست کارها
def نمایش_کارها():
    print("🗂️ لیست کارهای پروژه:")
    print("-" * 50)
    for i, کار in enumerate(کارهای_پروژه):
        تاریخ_پایان = محاسبه_تاریخ_پایان(کار["تاریخ_شروع"], کار["مدت_زمان"])
        print(f"{i+1}. 📌 نام کار: {کار['نام']}")
        print(f"   📅 تاریخ شروع: {کار['تاریخ_شروع']}")
        print(f"   🏁 تاریخ پایان: {تاریخ_پایان}")
        print(f"   ⏱️ مدت زمان: {کار['مدت_زمان']} روز")
        print(f"   📍 وضعیت: {وضعیت(کار['وضعیت'])}")
        print(f"   ⭐ اولویت: {کار['اولویت']}")
        print("-" * 50)

# ویرایش یک کار
def ویرایش_کار(index):
    if 0 <= index < len(کارهای_پروژه):
        کار = کارهای_پروژه[index]
        print(f"در حال ویرایش: {کار['نام']}")
        کار['نام'] = input("نام جدید: ") or کار['نام']
        کار['تاریخ_شروع'] = input("تاریخ شروع جدید (yyyy-mm-dd): ") or کار['تاریخ_شروع']
        مدت = input("مدت زمان جدید (روز): ")
        if مدت:
            کار['مدت_زمان'] = int(مدت)
        کار['وضعیت'] = input("وضعیت جدید (تموم شده / در حال انجام): ") or کار['وضعیت']
        کار['اولویت'] = input("اولویت جدید (بالا / متوسط / کم): ") or کار['اولویت']
    else:
        print("شماره نامعتبر است!")

# ذخیره فایل
def ذخیره_در_فایل():
    with open(fileName, "w", encoding="utf-8") as f:
        json.dump(کارهای_پروژه, f, ensure_ascii=False, indent=2)
    print("✅ اطلاعات ذخیره شد.")

# بارگذاری از فایل
def بارگذاری_از_فایل():
    try:
        with open(fileName, "r", encoding="utf-8") as f:
            return json.load(f)
    except FileNotFoundError:
        return []

# داده اولیه اگر فایل وجود نداشته باشد
کارهای_پروژه = بارگذاری_از_فایل() or [
    {
        "نام": "طراحی رابط کاربری",
        "تاریخ_شروع": "2025-04-01",
        "مدت_زمان": 5,
        "وضعیت": "تموم شده",
        "اولویت": "بالا"
    },
    {
        "نام": "پیاده سازی پایگاه داده",
        "تاریخ_شروع": "2025-04-06",
        "مدت_زمان": 7,
        "وضعیت": "در حال انجام",
        "اولویت": "متوسط"
    }
]

# منوی اصلی
while True:
    print("\n🎯 مدیریت پروژه")
    print("1. نمایش کارها")
    print("2. ویرایش یک کار")
    print("3. ذخیره در فایل")
    print("4. خروج")

    انتخاب = input("انتخاب شما: ")

    if انتخاب == "1":
        نمایش_کارها()
    elif انتخاب == "2":
        نمایش_کارها()
        شماره = int(input("شماره کار برای ویرایش: ")) - 1
        ویرایش_کار(شماره)
    elif انتخاب == "3":
        ذخیره_در_فایل()
    elif انتخاب == "4":
        ذخیره_در_فایل()
        print("🚪 خروج از برنامه...")
        break
    else:
        print("لطفاً گزینه معتبر وارد کنید.")
